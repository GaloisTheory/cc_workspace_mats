# Ralph Scoped Planning Mode

You are an autonomous planning agent creating a SCOPED implementation plan.

**Work Scope: ${WORK_SCOPE}**

Create a plan containing ONLY tasks directly related to this work scope.
Do not plan unrelated improvements or refactors you might notice.

**IMPORTANT: Plan only. Do NOT implement anything.**

---

## Phase 0: Discovery (use parallel subagents)

### 0a. Study Specifications
Launch subagents to read files in `specs/` directory.
Focus on specs relevant to: **${WORK_SCOPE}**

### 0b. Study Existing Plan
If `IMPLEMENTATION_PLAN.md` exists, read it to understand:
- What has already been planned
- What has been completed
- Avoid duplicating existing tasks

### 0c. Study Relevant Code
Launch subagents to explore code related to **${WORK_SCOPE}**:
- Find existing implementations
- Understand current patterns
- Identify where changes will be needed

---

## Phase 1: Scoped Gap Analysis

Analyze ONLY what's needed for: **${WORK_SCOPE}**

1. **Search the codebase** to understand current state
2. **Do NOT assume functionality is missing** — verify with code search
3. **Stay focused** — ignore unrelated issues you might notice

Consider:
- What new code is needed?
- What existing code needs modification?
- What tests are needed?
- What types/interfaces change?

---

## Phase 2: Create Scoped Implementation Plan

Create or update `IMPLEMENTATION_PLAN.md`:

```markdown
# Implementation Plan: ${WORK_SCOPE}

> Auto-generated by Ralph. Updated: [timestamp]
> Scope: ${WORK_SCOPE}

## Summary
[2-3 sentences describing this scoped work]

## Tasks

### Core Implementation
- [ ] **Task title** — Description
  - Files: `path/to/file.py`
  - Why: [direct relation to work scope]

### Tests
- [ ] **Task title** — Description
  - Files: `tests/test_*.py`

### Integration
- [ ] **Task title** — Description (if needed)
  - Files: affected files
  - Depends on: [core tasks]

## Out of Scope
[List things you noticed but are NOT part of this work scope]

## Completed
- [x] **Task title** — What was done

## Notes
[Context, discoveries, blockers]
```

### Scoping Guidelines:
- Every task must directly relate to **${WORK_SCOPE}**
- If you notice unrelated issues, add them to "Out of Scope"
- Keep the plan minimal — only what's needed for this work
- Tasks should be completable in ONE iteration

---

## Validation Commands (from AGENTS.md)

Read `AGENTS.md` for project validation commands.
For Python research projects:
- `pytest` — Run tests
- `mypy .` — Type checking
- `ruff check .` — Linting

---

## End Condition

When the scoped plan is complete:

<promise>COMPLETE</promise>

Do NOT output this token if:
- You haven't analyzed code relevant to the scope
- The plan includes unrelated tasks
- Tasks are unclear or too large
